# CHANGELOG workflo/macros

## 0.2.23

### Added

* Add a `merge-schemas` function to merge DataScript schemas
  and detect conflicting attribute schemas.

## 0.2.22

### Changed

* Update all dependencies to their latest versions.

### Fixed

* Always refer to devcard macros with `:refer-macros`.

## 0.2.21

### Added

* Add support for generating Datomic schemas from entities
  with attributes that have mixed namespaces.
* Add a `merge-schemas` function to merge Datomic schemas.

## 0.2.20

### Fixed

* Fix availability of our macros in ClojureScript by requiring
  them with :require-macros.

### Changed

* Use `:refer` instead of `:refer-macros` in ClojureScript
  wherever we can.

## 0.2.19

### Fixed

* Only build snapshot/release JARs once when deploying them
  to Clojars.

## 0.2.18

### Fixed

* Fix alias for `camelize-keys` in `workflo.macros.jscomponents`.

## 0.2.17

### Added

* Add a `camelize-keys` function to recursively convert keys in
  a map to camel-case.

### Changed

* Change `defjscomponents`, so the keys in props are converted
  to camel-case using `camelize-keys` before they are passed to
  the JS components.

## 0.2.16

### Added

* Add an `entity-refs` spec that can be used to define entities
  or entity keys that refer to one or many instances of another
  entity.
* Add `entity-refs` function to extract references of an entity
  to other entities.
* Add `keys` and `optional-keys` functions to obtain all keys
  and only the optional keys of an entity.

### Changed

* Move `val-after` function into `workflo.macros.util.misc`.
* Rename `:cmd-params` to `:cmd-data` in Om Next mutation
  payload generated by the default `:run-command` hook for
  `defview`.

## 0.2.15

### Added

* Add a `with-query-bindings` macro to automatically and deeply
  destructure query results with the help of the query they
  correspond to. Use this to wrap all function forms in `defview`,
  `defcommand` and `defservice` in order to bind as many parts
  of the query results to short names from the query itself as
  possible.
* Add documentation generation using Codox `via `boot docs`.
* Add a `boot production` task to be able to test examples with
  CLJS advanced optimizations.
* Add support for CLJS REPLs in Cider.

### Changed

* Rewrite the query language and its specs to add support for
  aliases (`:as`).
* Rewrite query parsing from scratch to support the updated
  query langauge and aliases in particular.
* Bump Clojure and ClojureScript to 1.9.0-alpha11 and 1.9.229,
  respectively; update all specs and tests accordingly and simplify
  (:require ...) in ns expressions.

### Removed

* Remove now unused `with-destructured-query` macro.

### Fixed

* Fix the way `defjscomponents` resolves JS components to make it
  work with advanced optimizations.
* Don't return nil from `workflo.macros.util.string/camel->kebab`
  when processing non-camel-case strings.

## 0.2.14

### Added

* Add support for typed URL segments in screens, with the help of Bidi.
* Add `(spec ...)` form to `defentity`.
* Add specs for various fundamental types for entities and entity
  keys in `workflo.macros.specs.types`.
* Add specs for type options (mostly for Datomic) in
  `workflo.macros.specs.types`.
* Add functions to extract schemas from entities in
  `workflo.macros.entity.schema`.
* Add Datomic schema generation from entities in
  `workflo.macros.entity.datomic`.
* Add DataScript schema generation from entities in
  `workflo.macros.entity.datascript`.

### Changed

* Only include examples when developing, not when running the
  tests. This ensures specs from examples and tests don't clash.
* Generate the initial :screen-mounted call before updating the
  root component query.

### Removed

* Remove `(validation ...)` form in `defentity`.
* Remove `(schema ...)` form in `defentity`.

### Fixed

* Fix invalid namespace forms in `workflo.macros.config` and
  `workflo.macros.registry`.
* Fix generator of `:workflo.macros.specs.view/view-form-args`
  spec to always generate valid view form arguments.

## 0.2.13

### Changed

* Allow arbitrary parameters to be passed to view commands,
  not just maps.

## 0.2.12

### Fixed

* Fixed Om Next query generation, particularly in
  ClojureScript.

## 0.2.11

### Changed

* `defview` now takes an optional `(commands [cmd ...])` form
  to make arbitrary external commands available in each view
  function; it comes with a `:run-command` hook that allows
  to handle these commands; this can then be used to transact
  Om Next mutations or call arbitrary functions.
* The syntax and names of forms in the macros was changed
  in various incompatible ways, e.g. the query and data spec
  vector in `(defcommand ... [<query> <spec>] ...)` were changed
  to `(defcommand ... (query ...) (spec ...))` forms.
* The `:process-result` hook of `defcommand` has been renamed
  to `:process-emit` and the implementation form of `defcommand`
  has been moved into `(emit <implementation>)`.
* The Om Next query generation for ClojureScript was improved
  and fixed, especially parameterized queries.

### Added

* `defentity` macro for bundle system entities with
  schemas/validation specs and authorization.
* `defscreen` macro for defining screens of ClojureScript
  apps with URL patterns, navigation information and views
  for different layout segments.
* A screen-based router and application layouer that works
  with Om Next, including a demo app (`screen-app.html`).
* `defservice` macro to define services that can be used to
  consume and process data emitted from commands written with
  `defcommand`. `defservice` generates a com.stuartsierra.component
  component for each service to allow straight forward integration
  of services written with `defservice` into systems built using
  `org.danielsz/system`.

## 0.2.10

### Changed

* Queries now support joins in combination with links, that is,
  links that are joined with models, properties or recursion, e.g.:
  `{[current-user _] [db [id] user [name email]]}`.
* The spec for parsed joins has changed to include an additional
  `:join-source` key that holds either a regular parsed property
  or a parsed link property. One example:
  `{:name current-user :type :join
    :join-source {:name current-user :type :link :link-id _}
    :join-target [{:name db/id :type :property}
                  {:name user/name :type :property}]}`.

### Fixed

* Generate '_ for global links in Om Next queries, not ''_.
* The CLJS generator for the `::map-destructuring-keys` spec now works.

## 0.2.9

### Added

* New functions to resolve variables and variable paths using
  potentially deeply nested parameter/value maps:
    - `workflo.macros.query.bind/var?`
    - `workflo.macros.query.bind/path?`
    - `workflo.macros.query.bind/denamespace`
    - `workflo.macros.query.bind/denamespace-keys`
    - `workflo.macros.query.bind/resolve-var`
    - `workflo.macros.query.bind/resolve-path`
    - `workflo.macros.query.bind/resolve`

### Fixed

* When binding query parameters, only recurse into join targets
  if they are real subqueries.

## 0.2.8

### Added

* Function to bind query parameters using a parameter/value
  map: `workflo.macros.query/bind-query-parameters`.
* A new syntax for binding query parameters to deeply
  nested values in the parameter map: `{param/name [?foo ?bar]}`
  in addition to `{param/name ?var}`.
* Bind defcommand query parameters using the command data
  as a parameter/value map.

## 0.2.7

### Changed

* Change notation for defcommand implementation forms by no
  longe requiring a sequence/list expression.

## 0.2.6

### Added

* A new defcommand macro for defining commands (e.g. handlers for
  Om Next mutations or other CQRS-style commands) with a store
  query, a command data spec and an implementation function.
* Data format specs:
    - `:workflo.macros.command.util/unqualified-symbol` - spec
      for a symbol without a namespace component.
    - `:workflo.macros.specs.query/query` - the data format for
      queries as used in the `defview` macro.
    - `:workflo.macros.specs.conforming-query/query` - the data
      format resulting from parsing queries with
      `clojure.spec/conform`.
    - `:workflo.macros.specs.parsed-query/query` - the data format
      generated by parsing queries with `workflo.macros.query/parse`.
    - `:workflo.macros.specs.om-query/query` - the data format for
      Om Next queries, as generated by `workflo.macros.query/om-query`.
* Function specs for the following functions:
    - `workflo.macros.query.util/combine-properties-and-groups`
    - `workflo.macros.query.util/capitalized-name`
    - `workflo.macros.query.util/capitalized-symbol?`
    - `workflo.macros.query.util/one-item?`
    - `workflo.macros.query/conform`
    - `workflo.macros.query/conform-and-parse`
    - `workflo.macros.query/parse-subquery`
    - `workflo.macros.query/parse`
    - `workflo.macros.query/map-destructuring-keys`
    - `workflo.macros.query.om-next/property-query`
    - `workflo.macros.query.om-next/query`
    - `workflo.macros.view/defview*`
    - `workflo.macros.command.util/bind-query-keys`
    - `workflo.macros.command.util/unqualify`
    - `workflo.macros.command.util/prefix-form-name`
    - `workflo.macros.command/defcommand*`
    - `workflo.macros.command.util/form->defn`
* Helper functions for query parsing:
    - `workflo.macros.query.util/combine-properties-and-groups`
    - `workflo.macros.query.util/capitalized-name`
    - `workflo.macros.query.util/capitalized-symbol?`
    - `workflo.macros.query.util/print-spec-gen`
    - `workflo.macros.query/parse-prop`
* Helper functions for defcommand:
    - `workflo.macros.command.util/bind-query-keys`
    - `workflo.macros.command.util/unqualify`
    - `workflo.macros.command.util/prefix-form-name`
    - `workflo.macros.command/defcommand*`
    - `workflo.macros.command.util/form->defn`
* New `workflo.macros.query/map-destructuring-keys` function for
  generating keys for destructuring properties from queries,
  replacing `map-keys`.
* New `workflo.macros.query.om-next/property-query` function to
  replace `workflo.macros.query/om-property-query`.
* New boot task `test-once` for running the test suites once.

### Changed

* Only define `defview` configuration atom once at load time.
* Properties specifications are now called queries everywhere.
* `workflo.macros.props` namespace renamed to `workflo.macros.query`
* Improved test suite capable of exercising most things in both,
  Clojure and ClojureScript.
* Random function tests based on clojure.spec generators.

### Removed

* `workflo.macros.props/map-keys` (replaced with
  `workflo.macros.query/map-destructuring-keys`)
* `workflo.macros.props/pad-by`
* `workflo.macros.props/property-name`
* `workflo.macros.props/property-type`
* `workflo.macros.props/property-query` (replaced with
  `workflo.macros.query.om-next/property-query`)
* `workflo.macros.props/value?`

## Notes

This changelog loosely follows the guidelines discussed on
[Keep a CHANGELOG](http://keepachangelog.com/).
