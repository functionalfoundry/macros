# CHANGELOG workflo/macros

## 0.2.10

## Changed

* Queries now support joins in combination with links, that is,
  links that are joined with models, properties or recursion, e.g.:
  `{[current-user _] [db [id] user [name email]]}`.
* The spec for parsed joins has changed to include an additional
  `:join-source` key that holds either a regular parsed property
  or a parsed link property. One example:
  `{:name current-user :type :join
    :join-source {:name current-user :type :link :link-id _}
    :join-target [{:name db/id :type :property}
                  {:name user/name :type :property}]}`.

## Fixed

* Generate '_ for global links in Om Next queries, not ''_.
* The CLJS generator for the `::map-destructuring-keys` spec now works.

## 0.2.9

## Added

* New functions to resolve variables and variable paths using
  potentially deeply nested parameter/value maps:
    - `workflo.macros.query.bind/var?`
    - `workflo.macros.query.bind/path?`
    - `workflo.macros.query.bind/denamespace`
    - `workflo.macros.query.bind/denamespace-keys`
    - `workflo.macros.query.bind/resolve-var`
    - `workflo.macros.query.bind/resolve-path`
    - `workflo.macros.query.bind/resolve`

## Fixed

* When binding query parameters, only recurse into join targets
  if they are real subqueries.

## 0.2.8

### Added

* Function to bind query parameters using a parameter/value
  map: `workflo.macros.query/bind-query-parameters`.
* A new syntax for binding query parameters to deeply
  nested values in the parameter map: `{param/name [?foo ?bar]}`
  in addition to `{param/name ?var}`.
* Bind defcommand query parameters using the command data
  as a parameter/value map.

## 0.2.7

### Changed

* Change notation for defcommand implementation forms by no
  longe requiring a sequence/list expression.

## 0.2.6

### Added

* A new defcommand macro for defining commands (e.g. handlers for
  Om Next mutations or other CQRS-style commands) with a store
  query, a command data spec and an implementation function.
* Data format specs:
    - `:workflo.macros.command.util/unqualified-symbol` - spec
      for a symbol without a namespace component.
    - `:workflo.macros.specs.query/query` - the data format for
      queries as used in the `defview` macro.
    - `:workflo.macros.specs.conforming-query/query` - the data
      format resulting from parsing queries with
      `clojure.spec/conform`.
    - `:workflo.macros.specs.parsed-query/query` - the data format
      generated by parsing queries with `workflo.macros.query/parse`.
    - `:workflo.macros.specs.om-query/query` - the data format for
      Om Next queries, as generated by `workflo.macros.query/om-query`.
* Function specs for the following functions:
    - `workflo.macros.query.util/combine-properties-and-groups`
    - `workflo.macros.query.util/capitalized-name`
    - `workflo.macros.query.util/capitalized-symbol?`
    - `workflo.macros.query.util/one-item?`
    - `workflo.macros.query/conform`
    - `workflo.macros.query/conform-and-parse`
    - `workflo.macros.query/parse-subquery`
    - `workflo.macros.query/parse`
    - `workflo.macros.query/map-destructuring-keys`
    - `workflo.macros.query.om-next/property-query`
    - `workflo.macros.query.om-next/query`
    - `workflo.macros.view/defview*`
    - `workflo.macros.command.util/bind-query-keys`
    - `workflo.macros.command.util/unqualify`
    - `workflo.macros.command.util/prefix-form-name`
    - `workflo.macros.command/defcommand*`
    - `workflo.macros.command.util/form->defn`
* Helper functions for query parsing:
    - `workflo.macros.query.util/combine-properties-and-groups`
    - `workflo.macros.query.util/capitalized-name`
    - `workflo.macros.query.util/capitalized-symbol?`
    - `workflo.macros.query.util/print-spec-gen`
    - `workflo.macros.query/parse-prop`
* Helper functions for defcommand:
    - `workflo.macros.command.util/bind-query-keys`
    - `workflo.macros.command.util/unqualify`
    - `workflo.macros.command.util/prefix-form-name`
    - `workflo.macros.command/defcommand*`
    - `workflo.macros.command.util/form->defn`
* New `workflo.macros.query/map-destructuring-keys` function for
  generating keys for destructuring properties from queries,
  replacing `map-keys`.
* New `workflo.macros.query.om-next/property-query` function to
  replace `workflo.macros.query/om-property-query`.
* New boot task `test-once` for running the test suites once.

### Changed

* Only define `defview` configuration atom once at load time.
* Properties specifications are now called queries everywhere.
* `workflo.macros.props` namespace renamed to `workflo.macros.query`
* Improved test suite capable of exercising most things in both,
  Clojure and ClojureScript.
* Random function tests based on clojure.spec generators.

### Removed

* `workflo.macros.props/map-keys` (replaced with
  `workflo.macros.query/map-destructuring-keys`)
* `workflo.macros.props/pad-by`
* `workflo.macros.props/property-name`
* `workflo.macros.props/property-type`
* `workflo.macros.props/property-query` (replaced with
  `workflo.macros.query.om-next/property-query`)
* `workflo.macros.props/value?`

## Notes

This changelog loosely follows the guidelines discussed on
[Keep a CHANGELOG](http://keepachangelog.com/).
