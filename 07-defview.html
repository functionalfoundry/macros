<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>Views (defview)</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script><link rel="stylesheet" type="text/css" href="macros.css" /><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/elm.min.js"></script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">workflo/macros</span> <span class="project-version">0.2.63</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="01-types.html"><div class="inner"><span>Type specs</span></div></a></li><li class="depth-1 "><a href="02-queries.html"><div class="inner"><span>Queries</span></div></a></li><li class="depth-1 "><a href="03-defpermission.html"><div class="inner"><span>Permissions (defpermission)</span></div></a></li><li class="depth-1 "><a href="04-defentity.html"><div class="inner"><span>Entities (defentity)</span></div></a></li><li class="depth-1 "><a href="05-defcommand.html"><div class="inner"><span>Commands (defcommand)</span></div></a></li><li class="depth-1 "><a href="06-defservice.html"><div class="inner"><span>Services (defservice)</span></div></a></li><li class="depth-1  current"><a href="07-defview.html"><div class="inner"><span>Views (defview)</span></div></a></li><li class="depth-1 "><a href="08-defscreen.html"><div class="inner"><span>Screens (defscreen)</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>workflo</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>macros</span></div></div></li><li class="depth-3 branch"><a href="workflo.macros.bind.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bind</span></div></a></li><li class="depth-3"><a href="workflo.macros.command.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>command</span></div></a></li><li class="depth-4"><a href="workflo.macros.command.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-3 branch"><a href="workflo.macros.config.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-3"><a href="workflo.macros.entity.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>entity</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.entity.datascript.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datascript</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.entity.datomic.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datomic</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.entity.refs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>refs</span></div></a></li><li class="depth-4"><a href="workflo.macros.entity.schema.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema</span></div></a></li><li class="depth-3 branch"><a href="workflo.macros.hooks.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>hooks</span></div></a></li><li class="depth-3 branch"><a href="workflo.macros.jscomponents.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jscomponents</span></div></a></li><li class="depth-3 branch"><a href="workflo.macros.permission.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>permission</span></div></a></li><li class="depth-3"><a href="workflo.macros.query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.query.bind.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bind</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.query.om-next.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>om-next</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.query.om-util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>om-util</span></div></a></li><li class="depth-4"><a href="workflo.macros.query.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-3 branch"><a href="workflo.macros.registry.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-3"><a href="workflo.macros.screen.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>screen</span></div></a></li><li class="depth-4"><a href="workflo.macros.screen.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-3"><a href="workflo.macros.service.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>service</span></div></a></li><li class="depth-4"><a href="workflo.macros.service.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>specs</span></div></div></li><li class="depth-4 branch"><a href="workflo.macros.specs.bind.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bind</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.command.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>command</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.conforming-query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>conforming-query</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.entity.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>entity</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.om-query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>om-query</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.parsed-query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>parsed-query</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.permission.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>permission</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.screen.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>screen</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.service.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>service</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.types.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>types</span></div></a></li><li class="depth-4"><a href="workflo.macros.specs.view.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>view</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -393px;"><span class="top" style="height: 402px;"></span><span class="bottom"></span></span><span>util</span></div></div></li><li class="depth-4 branch"><a href="workflo.macros.util.form.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>form</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.util.macro.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>macro</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.util.misc.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>misc</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.util.string.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>string</span></div></a></li><li class="depth-4"><a href="workflo.macros.util.symbol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>symbol</span></div></a></li><li class="depth-3"><a href="workflo.macros.view.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>view</span></div></a></li><li class="depth-4"><a href="workflo.macros.view.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#views-defview-" name="views-defview-"></a>Views (defview)</h1>
<p><em>Defining Om Next components in a compact way.</em></p>
<p>Om Next views are a combination of an Om Next component defined with <code>om.next/defui</code> and a component factory created with <code>om.next/factory</code>. The <code>defview</code> macro combines these two into a single definition and reduces the boilerplate code needed to define properties, idents, React keys, queries and component functions.</p>
<h3><a href="#defining-views" name="defining-views"></a>Defining views</h3>
<p>Views are defined using <code>defview</code>, accepting the following information:</p>
<ul>
  <li>A query for properties (optional)</li>
  <li>A query for computed properties (optional)</li>
  <li>A <code>key</code> or <code>keyfn</code> function (optional)</li>
  <li>A <code>validate</code> or <code>validator</code> function (optional)</li>
  <li>An arbitrary number of regular Om Next, React or JS  functions (e.g. <code>query</code>, <code>ident</code>, <code>componentWillMount</code>  or <code>render</code>).</li>
</ul>
<p>A <code>(defview UserProfile ...)</code> expression defines both a <code>UserProfile</code> component and a <code>user-profile</code> component factory.</p>
<h3><a href="#properties-destructuring" name="properties-destructuring"></a>Properties destructuring</h3>
<p>All properties declared via the queries are made available in component functions via an implicit <code>let</code> statement wrapping the original function body in the view definition.</p>
<p>As an example, the properties query</p>
<pre><code class="clojure">[user [name email {friends ...}] [current-user _]]
</code></pre>
<p>would destructure the resulting properties as follows:</p>
<pre><code class="clojure">:user/name    -&gt; name
:user/email   -&gt; email
:user/friends -&gt; friends
:current-user -&gt; current-user
</code></pre>
<h3><a href="#automatic-om-next-query-generation" name="automatic-om-next-query-generation"></a>Automatic Om Next query generation</h3>
<p>The <code>defview</code> macro predefines <code>(query ...)</code> for any view based on the properties query. Auto-generation currently supports joins, links, parameterization but no unions.</p>
<p>As an example, the properties query</p>
<pre><code class="clojure">[user [name email {friends User}] [current-user _]]
</code></pre>
<p>would generate the following <code>query</code> function:</p>
<pre><code class="clojure">static om.next/IQuery
(query [this]
  [:user/name
   :user/email
   {:user/friends (om/get-query User)}
   [:current-user _]])
</code></pre>
<p>This can be overriden simply by implementing your own <code>query</code>:</p>
<pre><code class="clojure">(defview User
  [...]
  (query
    [:name :email]))
</code></pre>
<p>In the future, we will likely add a simple way to transform auto-generated queries. On idea is to implicitly bind the auto-generated query when overriding <code>query</code> and providing convenient methods to parameterize sub-queries, e.g.</p>
<pre><code class="clojure">(query
  (-&gt; auto-query
      (set-param :user/friends :param :value)
      (set-param :current-user :id [:user 15])))
</code></pre>
<h3><a href="#automatic-inference-of-and" name="automatic-inference-of-and"></a>Automatic inference of <code>ident</code> and <code>:keyfn</code></h3>
<p>If the properties query includes <code>[db [id]]</code>, corresponding to the Om Next query attribute <code>:db/id</code>, it is assumed that the view represents data from DataScript or Datomic. In this case, <code>defview</code> will automatically infer <code>(ident ...)</code> and <code>(key ...)</code> / <code>:keyfn</code> functions based on the database ID. This behavior can be overriden by specifically defining both ident and key.</p>
<p>As an example:</p>
<pre><code>(defview User
  [db [id] user [name]])
</code></pre>
<p>will result in the equivalent of:</p>
<pre><code>(defui User
  static om/Ident
  (ident [this {:keys [db/id]}]
    [:db/id id]))

(def user (om/factory User {:keyfn :db/id}))
</code></pre>
<h3><a href="#implicit-binding-of-and-in-functions" name="implicit-binding-of-and-in-functions"></a>Implicit binding of <code>this</code> and <code>props</code> in functions</h3>
<p>The names <code>this</code> and <code>props</code> are available inside function bodies depending on their signature (e.g. <code>render</code> only makes <code>this</code> available, whereas <code>ident</code> pre-binds <code>this</code> and <code>props</code>).</p>
<h3><a href="#custom-raw-functions-with-their-own-argument-vectors" name="custom-raw-functions-with-their-own-argument-vectors"></a>Custom (raw) functions with their own argument vectors</h3>
<p>By default, <code>defview</code> implicitly assumes the arguments to custom functions, i.e., functions other than Om Next and React lifecycle functions, are <code>[this]</code>. However, when adding JS object functions to a view, you’ll often want additional arguments. Here is an example highlighting the problem:</p>
<pre><code class="clojure">(defview UserList
  [users]
  (select ;; implictly adds [this]
    ;; where should the user ID come from?
    (om/transact! this `[(users/select {:user ~???})])))
</code></pre>
<p>To solve this problem, <code>defview</code> supports a <code>.</code> syntax for custom function definitions. Any function that starts with a <code>.</code> will become a JS object function and its arguments will remain untouched:</p>
<pre><code class="clojure">(defview UserList
  [users]
  (.select [this user]
    (om/transact! this `[(users/select {:user ~user})])))
</code></pre>
<p>Inside the view, this function can now be called with <code>(.select this &lt;user id&gt;)</code>, just like any other JS object function.</p>
<h3><a href="#example" name="example"></a>Example</h3>
<pre><code class="clojure">(ns foo.bar
  (:require [workflo.macros.view :refer [defview]]))

(defview User
  [user [name email address {friends ...}]]
  [ui [selected?] select-fn]
  (key name)
  (validate (string? name))
  (ident [:user/by-name name])
  (render
    (dom/div #js {:className (when selected? "selected")
                  :onClick (select-fn (om/get-ident this))}
      (dom/h1 nil "User: " name)
      (dom/p nil "Address: " street " " house))))
</code></pre>
<p>Example usage in Om Next:</p>
<pre><code class="clojure">(user (om/computed {:user/name "Jeff"
                    :user/email "jeff@jeff.org"
                    :user/address {:street "Elmstreet"
                                   :house 13}}
                   {:ui/selected? true
                    :select-fn #(js/alert "Selected!")))
</code></pre></div></div></div></body></html>