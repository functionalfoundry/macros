<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>workflo.macros.query documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script><link rel="stylesheet" type="text/css" href="macros.css" /><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/elm.min.js"></script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">workflo/macros</span> <span class="project-version">0.2.63</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="01-types.html"><div class="inner"><span>Type specs</span></div></a></li><li class="depth-1 "><a href="02-queries.html"><div class="inner"><span>Queries</span></div></a></li><li class="depth-1 "><a href="03-defpermission.html"><div class="inner"><span>Permissions (defpermission)</span></div></a></li><li class="depth-1 "><a href="04-defentity.html"><div class="inner"><span>Entities (defentity)</span></div></a></li><li class="depth-1 "><a href="05-defcommand.html"><div class="inner"><span>Commands (defcommand)</span></div></a></li><li class="depth-1 "><a href="06-defservice.html"><div class="inner"><span>Services (defservice)</span></div></a></li><li class="depth-1 "><a href="07-defview.html"><div class="inner"><span>Views (defview)</span></div></a></li><li class="depth-1 "><a href="08-defscreen.html"><div class="inner"><span>Screens (defscreen)</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>workflo</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>macros</span></div></div></li><li class="depth-3 branch"><a href="workflo.macros.bind.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bind</span></div></a></li><li class="depth-3"><a href="workflo.macros.command.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>command</span></div></a></li><li class="depth-4"><a href="workflo.macros.command.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-3 branch"><a href="workflo.macros.config.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-3"><a href="workflo.macros.entity.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>entity</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.entity.datascript.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datascript</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.entity.datomic.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datomic</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.entity.refs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>refs</span></div></a></li><li class="depth-4"><a href="workflo.macros.entity.schema.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema</span></div></a></li><li class="depth-3 branch"><a href="workflo.macros.hooks.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>hooks</span></div></a></li><li class="depth-3 branch"><a href="workflo.macros.jscomponents.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jscomponents</span></div></a></li><li class="depth-3 branch"><a href="workflo.macros.permission.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>permission</span></div></a></li><li class="depth-3 current"><a href="workflo.macros.query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.query.bind.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bind</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.query.om-next.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>om-next</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.query.om-util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>om-util</span></div></a></li><li class="depth-4"><a href="workflo.macros.query.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-3 branch"><a href="workflo.macros.registry.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-3"><a href="workflo.macros.screen.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>screen</span></div></a></li><li class="depth-4"><a href="workflo.macros.screen.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-3"><a href="workflo.macros.service.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>service</span></div></a></li><li class="depth-4"><a href="workflo.macros.service.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>specs</span></div></div></li><li class="depth-4 branch"><a href="workflo.macros.specs.bind.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bind</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.command.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>command</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.conforming-query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>conforming-query</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.entity.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>entity</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.om-query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>om-query</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.parsed-query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>parsed-query</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.permission.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>permission</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.screen.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>screen</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.service.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>service</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.specs.types.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>types</span></div></a></li><li class="depth-4"><a href="workflo.macros.specs.view.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>view</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -393px;"><span class="top" style="height: 402px;"></span><span class="bottom"></span></span><span>util</span></div></div></li><li class="depth-4 branch"><a href="workflo.macros.util.form.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>form</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.util.macro.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>macro</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.util.misc.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>misc</span></div></a></li><li class="depth-4 branch"><a href="workflo.macros.util.string.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>string</span></div></a></li><li class="depth-4"><a href="workflo.macros.util.symbol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>symbol</span></div></a></li><li class="depth-3"><a href="workflo.macros.view.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>view</span></div></a></li><li class="depth-4"><a href="workflo.macros.view.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="workflo.macros.query.html#var-.2Bquery-fragment-registry.2B"><div class="inner"><span>+query-fragment-registry+</span></div></a></li><li class="depth-1"><a href="workflo.macros.query.html#var-bind-query-parameters"><div class="inner"><span>bind-query-parameters</span></div></a></li><li class="depth-1"><a href="workflo.macros.query.html#var-conform"><div class="inner"><span>conform</span></div></a></li><li class="depth-1"><a href="workflo.macros.query.html#var-conform-and-parse"><div class="inner"><span>conform-and-parse</span></div></a></li><li class="depth-1"><a href="workflo.macros.query.html#var-map-destructuring-keys"><div class="inner"><span>map-destructuring-keys</span></div></a></li><li class="depth-1"><a href="workflo.macros.query.html#var-parse"><div class="inner"><span>parse</span></div></a></li><li class="depth-1"><a href="workflo.macros.query.html#var-parse-subquery"><div class="inner"><span>parse-subquery</span></div></a></li><li class="depth-1"><a href="workflo.macros.query.html#var-query-type"><div class="inner"><span>query-type</span></div></a></li><li class="depth-1"><a href="workflo.macros.query.html#var-register-query-fragment.21"><div class="inner"><span>register-query-fragment!</span></div></a></li><li class="depth-1"><a href="workflo.macros.query.html#var-registered-query-fragments"><div class="inner"><span>registered-query-fragments</span></div></a></li><li class="depth-1"><a href="workflo.macros.query.html#var-reset-registered-query-fragments.21"><div class="inner"><span>reset-registered-query-fragments!</span></div></a></li><li class="depth-1"><a href="workflo.macros.query.html#var-resolve-query-fragment"><div class="inner"><span>resolve-query-fragment</span></div></a></li><li class="depth-1"><a href="workflo.macros.query.html#var-unregister-query-fragment.21"><div class="inner"><span>unregister-query-fragment!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">workflo.macros.query</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-.2Bquery-fragment-registry.2B"><h3>+query-fragment-registry+</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/functionalfoundry/macros/blob/0.2.63/src/main/workflo/macros/query.cljc#L15">view source</a></div></div><div class="public anchor" id="var-bind-query-parameters"><h3>bind-query-parameters</h3><div class="usage"><code>(bind-query-parameters query params)</code></div><div class="doc"><div class="markdown"><p>Takes a parsed query and a map of named parameters and their values. Binds the unbound parameters in the query (that is, those where the value is either a symbol beginning with a ? or a vector of such symbols) to values of the corresponding parameters in the parameter map and returns the result.</p>
<p>As an example, the :db/id parameter in the query</p>
<p>[{:name user :type :join  :join-target [{:name name :type :property}]  :parameters {:db/id ?foo  :user/friend [?bar ?baz]}}]</p>
<p>would be bound to the value 10 if the parameter map was {:foo 10 :bar {:baz :ruux}} and the :user/friend parameter would be bound to the value :ruux.</p></div></div><div class="src-link"><a href="https://github.com/functionalfoundry/macros/blob/0.2.63/src/main/workflo/macros/query.cljc#L201">view source</a></div></div><div class="public anchor" id="var-conform"><h3>conform</h3><div class="usage"><code>(conform query)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/functionalfoundry/macros/blob/0.2.63/src/main/workflo/macros/query.cljc#L161">view source</a></div></div><div class="public anchor" id="var-conform-and-parse"><h3>conform-and-parse</h3><div class="usage"><code>(conform-and-parse query)</code></div><div class="doc"><div class="markdown"><p>Conforms and parses a query expression like</p>
<pre><code>[user [name :as nm email {friends User}] [current-user _]]
</code></pre>
<p>into a flat vector of parsed properties with the following structure:</p>
<pre><code>[{:name user/name :type :property :alias nm}
 {:name user/email :type :property}
 {:name user/friends :type :join :join-target User}
 {:name current-user :type :link :link-id _}].
</code></pre>
<p>From this it is trivial to generate queries for arbitrary frameworks (e.g. Om Next) as well as keys for destructuring the results.</p></div></div><div class="src-link"><a href="https://github.com/functionalfoundry/macros/blob/0.2.63/src/main/workflo/macros/query.cljc#L168">view source</a></div></div><div class="public anchor" id="var-map-destructuring-keys"><h3>map-destructuring-keys</h3><div class="usage"><code>(map-destructuring-keys query)</code></div><div class="doc"><div class="markdown"><p>Generates keys for destructuring a map of query results.</p></div></div><div class="src-link"><a href="https://github.com/functionalfoundry/macros/blob/0.2.63/src/main/workflo/macros/query.cljc#L196">view source</a></div></div><div class="public anchor" id="var-parse"><h3>parse</h3><div class="usage"><code>(parse query)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/functionalfoundry/macros/blob/0.2.63/src/main/workflo/macros/query.cljc#L152">view source</a></div></div><div class="public anchor" id="var-parse-subquery"><h3>parse-subquery</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Takes a subquery and returns a vector of parsed properties, each in one of the following forms:</p>
<pre><code>{:name user/name :type :property :alias user-name}
{:name user/email :type :property}
{:name user/friends :type :join
 :join-source {name user/friends :type :property}
 :join-target User}
{:name user/friends :type :join
 :join-source {:name user/friends :type :property}
 :join-target [{:name user/name :type :property}]}
{:name current-user :type :link :link-id _}.
</code></pre>
<p>Each of these may in addition contain an optional :parameters key with a {symbol ?variable}-style map and an :alias key with a symbol to use when destructuring instead of the original name.</p></div></div><div class="src-link"><a href="https://github.com/functionalfoundry/macros/blob/0.2.63/src/main/workflo/macros/query.cljc#L45">view source</a></div></div><div class="public anchor" id="var-query-type"><h3>query-type</h3><div class="usage"><code>(query-type query)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/functionalfoundry/macros/blob/0.2.63/src/main/workflo/macros/query.cljc#L29">view source</a></div></div><div class="public anchor" id="var-register-query-fragment.21"><h3>register-query-fragment!</h3><div class="usage"><code>(register-query-fragment! name def)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/functionalfoundry/macros/blob/0.2.63/src/main/workflo/macros/query.cljc#L15">view source</a></div></div><div class="public anchor" id="var-registered-query-fragments"><h3>registered-query-fragments</h3><div class="usage"><code>(registered-query-fragments)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/functionalfoundry/macros/blob/0.2.63/src/main/workflo/macros/query.cljc#L15">view source</a></div></div><div class="public anchor" id="var-reset-registered-query-fragments.21"><h3>reset-registered-query-fragments!</h3><div class="usage"><code>(reset-registered-query-fragments!)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/functionalfoundry/macros/blob/0.2.63/src/main/workflo/macros/query.cljc#L15">view source</a></div></div><div class="public anchor" id="var-resolve-query-fragment"><h3>resolve-query-fragment</h3><div class="usage"><code>(resolve-query-fragment name)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/functionalfoundry/macros/blob/0.2.63/src/main/workflo/macros/query.cljc#L15">view source</a></div></div><div class="public anchor" id="var-unregister-query-fragment.21"><h3>unregister-query-fragment!</h3><div class="usage"><code>(unregister-query-fragment! name)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/functionalfoundry/macros/blob/0.2.63/src/main/workflo/macros/query.cljc#L15">view source</a></div></div></div></body></html>